<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Catatan Tugas Sekolah</title>
  <style>
    /* Variabel CSS untuk kemudahan kustomisasi tema */
    :root {
      --primary-color: #1e88e5;
      --secondary-color: #e3f2fd;
      --text-color: #333;
      --light-gray: #f1f4f9;
      --border-color: #ddd;
      --shadow-light: 0 2px 4px rgba(0, 0, 0, 0.05);
      --shadow-card: 0 2px 4px rgba(0, 0, 0, 0.1);
      --danger-color: #e53935;
      --success-color: #4caf50;
    }

    /* Mengatur font global dan box-sizing */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: var(--light-gray);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-y: auto;
    }

    header {
      background: var(--primary-color);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    header h1 {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .datetime {
      font-size: 0.9rem;
      color: #e3f2fd;
      text-align: right;
    }

    nav {
      display: flex;
      justify-content: center;
      background: #fff;
      box-shadow: var(--shadow-light);
      border-bottom: 1px solid var(--border-color);
    }

    .tab-btn {
      flex: 1;
      padding: 14px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      color: #555;
      position: relative;
      transition: all 0.3s ease;
    }

    .tab-btn:hover {
      color: var(--primary-color);
    }

    .tab-btn.active {
      color: var(--primary-color);
      font-weight: bold;
    }

    .tab-btn.active::after {
      content: "";
      position: absolute;
      left: 20%;
      bottom: 0;
      width: 60%;
      height: 3px;
      background: var(--primary-color);
      border-radius: 5px;
    }

    main {
      padding: 20px;
      flex-grow: 1;
      max-width: 800px;
      width: 100%;
      margin: 0 auto;
    }

    .page {
      display: none;
      animation: fadeIn 0.4s ease-in;
    }

    .page.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .task-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 20px auto 0;
    }

    input, textarea, button {
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
      width: 100%;
    }

    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
    }

    button:hover {
      background-color: #1565c0;
    }

    button:active {
      transform: scale(0.98);
    }

    .task-list {
      margin-top: 20px;
    }

    .task-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 15px;
      box-shadow: var(--shadow-card);
      position: relative;
      transition: transform 0.2s ease;
    }

    .task-card:hover {
      transform: translateY(-3px);
    }

    .task-card.today {
      border-left: 5px solid var(--danger-color);
      background-color: #fff4f4;
    }

    .task-card h3 {
      margin-bottom: 5px;
      font-size: 1.2rem;
    }

    .task-card p {
      color: #555;
      font-size: 0.95rem;
      margin-top: 5px;
    }

    .task-card small {
      color: #888;
      display: block;
      margin-top: 10px;
      font-style: italic;
    }

    .task-actions {
      margin-top: 15px;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .task-actions .edit-btn, .task-actions .delete-btn {
      padding: 8px 12px;
      font-size: 0.9rem;
      width: auto;
    }

    .task-actions .edit-btn {
      background-color: #2196f3;
    }

    .task-actions .delete-btn {
      background-color: var(--danger-color);
    }

    footer {
      text-align: center;
      padding: 15px;
      background: var(--secondary-color);
      font-size: 0.8rem;
      margin-top: auto;
      color: #666;
    }

    /* Modal Styling */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: white;
      padding: 25px;
      border-radius: 10px;
      width: 90%;
      max-width: 450px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      position: relative;
    }

    .modal-content h3 {
      margin-bottom: 20px;
    }

    .modal-content input, .modal-content textarea {
      margin-bottom: 15px;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    .modal-actions button {
      width: auto;
      padding: 10px 20px;
    }

    .close-modal-btn {
      background-color: #6c757d;
    }

    .confirm-modal-actions .confirm-btn {
        background-color: var(--danger-color);
    }

    .confirm-modal-actions .cancel-btn {
        background-color: #6c757d;
    }
  </style>
</head>
<body>

  <header>
    <h1>Catatan Tugas Sekolah</h1>
    <div class="datetime" id="datetime"></div>
  </header>

  <nav>
    <button class="tab-btn active" data-page="lihat">ðŸ“‹ Lihat Tugas</button>
    <button class="tab-btn" data-page="tambah">âž• Tambah Tugas</button>
  </nav>

  <main>
    <div class="page active" id="lihat">
      <h2>Daftar Tugas</h2>
      <div class="task-list" id="taskList"></div>
    </div>
  
    <div class="page" id="tambah">
      <h2>Tambah Tugas Baru</h2>
      <form class="task-form" id="taskForm">
        <input type="text" id="judul" placeholder="Judul Tugas" required />
        <textarea id="deskripsi" rows="4" placeholder="Deskripsi tugas..."></textarea>
        <input type="date" id="deadline" required />
        <button type="submit">Simpan Tugas</button>
      </form>
    </div>
  </main>

  <footer>
    <p>Dibuat oleh Fardan Rendara â€¢ Â© 2025</p>
    <p>Versi 1.3.0</p>
  </footer>

  <!-- Modal Edit -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <h3>Edit Tugas</h3>
      <form id="editForm">
        <input type="text" id="editJudul" required />
        <textarea id="editDeskripsi" rows="4"></textarea>
        <input type="date" id="editDeadline" required />
        <div class="modal-actions">
            <button type="submit">Simpan Perubahan</button>
            <button type="button" class="close-modal-btn" id="closeEditModalBtn">Batal</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Konfirmasi Hapus -->
  <div class="modal" id="confirmModal">
    <div class="modal-content">
      <h3>Konfirmasi Hapus</h3>
      <p>Yakin ingin menghapus tugas ini?</p>
      <div class="modal-actions confirm-modal-actions">
        <button type="button" class="confirm-btn">Hapus</button>
        <button type="button" class="cancel-btn">Batal</button>
      </div>
    </div>
  </div>

  <script>
    const datetimeEl = document.getElementById('datetime');
    const taskListEl = document.getElementById('taskList');
    const tabButtons = document.querySelectorAll('.tab-btn');
    const pages = document.querySelectorAll('.page');
    const taskForm = document.getElementById('taskForm');
    const editModal = document.getElementById('editModal');
    const editForm = document.getElementById('editForm');
    const confirmModal = document.getElementById('confirmModal');

    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    let currentEditIndex = null;
    let pendingDeleteIndex = null;

    /**
     * Mengelola navigasi tab.
     */
    function setupTabNavigation() {
        tabButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                // Menghapus kelas 'active' dari semua tab dan halaman
                tabButtons.forEach(b => b.classList.remove('active'));
                pages.forEach(p => p.classList.remove('active'));

                // Menambahkan kelas 'active' pada tab dan halaman yang dipilih
                btn.classList.add('active');
                document.getElementById(btn.dataset.page).classList.add('active');
            });
        });
    }

    /**
     * Memperbarui tanggal dan waktu setiap detik.
     */
    function updateDateTime() {
      const now = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      datetimeEl.textContent = now.toLocaleDateString('id-ID', options) + " - " + now.toLocaleTimeString('id-ID');
    }

    /**
     * Menyimpan data tugas ke Local Storage.
     */
    function saveTasks() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
    }

    /**
     * Merender (menampilkan) daftar tugas ke halaman.
     */
    function renderTasks() {
      taskListEl.innerHTML = '';
      const today = new Date().toISOString().split('T')[0];
    
      // Mengurutkan tugas berdasarkan deadline terdekat
      const sortedTasks = [...tasks].sort((a, b) => new Date(a.deadline) - new Date(b.deadline));
    
      sortedTasks.forEach((task, index) => {
        const isToday = task.deadline === today;
        const card = document.createElement('div');
        // Menggunakan index dari array asli untuk identifikasi, bukan sortedTasks
        const originalIndex = tasks.findIndex(t => t === task); 
        card.className = `task-card ${isToday ? 'today' : ''}`;
        card.innerHTML = `
          <h3>${task.judul}</h3>
          <p>${task.deskripsi}</p>
          <small>Deadline: ${new Date(task.deadline).toLocaleDateString('id-ID', {
            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
          })}</small>
          <div class="task-actions">
            <button class="edit-btn" data-index="${originalIndex}">Edit</button>
            <button class="delete-btn" data-index="${originalIndex}">Hapus</button>
          </div>
        `;
        taskListEl.appendChild(card);
      });
    }

    /**
     * Menangani pengiriman form untuk menambah tugas baru.
     */
    function handleAddTask(e) {
      e.preventDefault();
      const judul = document.getElementById('judul').value;
      const deskripsi = document.getElementById('deskripsi').value;
      const deadline = document.getElementById('deadline').value;

      tasks.push({ judul, deskripsi, deadline });
      saveTasks();
      renderTasks();

      // Reset form dan pindah ke tab 'Lihat Tugas'
      taskForm.reset();
      document.querySelector('.tab-btn[data-page="lihat"]').click();
    }

    /**
     * Menghapus tugas berdasarkan indeks.
     */
    function deleteTask(index) {
        tasks.splice(index, 1);
        saveTasks();
        renderTasks();
    }

    /**
     * Menampilkan modal edit dengan data tugas yang dipilih.
     */
    function openEditModal(index) {
      currentEditIndex = index;
      const task = tasks[index];
      document.getElementById('editJudul').value = task.judul;
      document.getElementById('editDeskripsi').value = task.deskripsi;
      document.getElementById('editDeadline').value = task.deadline;
      editModal.classList.add('show');
    }

    /**
     * Menutup modal edit.
     */
    function closeEditModal() {
        editModal.classList.remove('show');
    }

    /**
     * Menangani pengiriman form untuk memperbarui tugas.
     */
    function handleUpdateTask(e) {
      e.preventDefault();
      const judul = document.getElementById('editJudul').value;
      const deskripsi = document.getElementById('editDeskripsi').value;
      const deadline = document.getElementById('editDeadline').value;

      tasks[currentEditIndex] = { judul, deskripsi, deadline };
      saveTasks();
      renderTasks();
      closeEditModal();
    }

    /**
     * Menampilkan modal konfirmasi untuk hapus.
     */
    function showConfirmModal(index) {
        pendingDeleteIndex = index;
        confirmModal.classList.add('show');
    }

    /**
     * Menutup modal konfirmasi.
     */
    function closeConfirmModal() {
        pendingDeleteIndex = null;
        confirmModal.classList.remove('show');
    }

    /**
     * Menginisialisasi event listeners.
     */
    function init() {
      // Event listener untuk tombol navigasi
      setupTabNavigation();

      // Event listener untuk form tambah tugas
      taskForm.addEventListener('submit', handleAddTask);
    
      // Event listener untuk tombol Edit dan Hapus (menggunakan event delegation)
      taskListEl.addEventListener('click', (e) => {
          if (e.target.classList.contains('edit-btn')) {
              const index = e.target.dataset.index;
              openEditModal(index);
          } else if (e.target.classList.contains('delete-btn')) {
              const index = e.target.dataset.index;
              showConfirmModal(index);
          }
      });
      
      // Event listener untuk form edit tugas
      editForm.addEventListener('submit', handleUpdateTask);
      
      // Event listener untuk tombol batal di modal edit
      document.getElementById('closeEditModalBtn').addEventListener('click', closeEditModal);

      // Event listener untuk modal konfirmasi
      confirmModal.querySelector('.confirm-btn').addEventListener('click', () => {
          if (pendingDeleteIndex !== null) {
              deleteTask(pendingDeleteIndex);
          }
          closeConfirmModal();
      });

      confirmModal.querySelector('.cancel-btn').addEventListener('click', closeConfirmModal);

      // Event listener untuk menutup modal saat klik di luar area modal
      window.addEventListener('click', (e) => {
          if (e.target === editModal) {
              closeEditModal();
          }
          if (e.target === confirmModal) {
              closeConfirmModal();
          }
      });

      // Memulai update waktu dan merender tugas pertama kali
      setInterval(updateDateTime, 1000);
      updateDateTime();
      renderTasks();
    }
    
    // Panggil fungsi inisialisasi saat dokumen selesai dimuat
    document.addEventListener('DOMContentLoaded', init);
  </script>

</body>
</html>
